<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Development Factor - Generador de Im치genes</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /*  loader    */
        
        /* From uiverse.io by @JulioCodesSM */
.loader {
 width: 50px;
 height: 50px;
 position: relative;
 transform: translateX(-25px);
 /* Compensating for the left of 50px in the keyframe. */
}

.loader::before,
.loader::after {
 content: '';
 position: absolute;
 width: inherit;
 height: inherit;
 border-radius: 50%;
 mix-blend-mode: multiply;
 animation: rotate9 1s infinite cubic-bezier(0.77, 0, 0.175, 1);
}

.loader::before {
 background-color: #e55319;
}

.loader::after {
 background-color: #194875;
 animation-delay: .5s;
}

@keyframes rotate9 {
 0%,100% {
  left: 50px;
 }

 25% {
  transform: scale(.3);
 }

 50% {
  left: 0;
 }

 75% {
  transform: scale(1);
 }
}
        
        
        /*  loader    */
        .logo-corner {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        .logo-corner img {
            width: 300px;
            height: auto;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }
        .logo-corner img:hover {
            opacity: 1;
        }
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
        .avatar {
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
        }
        .avatar.selected img {
           
            box-shadow: 0 0 15px rgba(67, 68, 68, 0.5);
            transform: scale(1.05);
        }
        .hair-option.selected {
            background: #434444ff !important;
            color: white !important;
            border-color: #434444ff !important;
        }
        .skin-option.selected {
            background: #434444ff !important;
            border-color: #434444ff !important;
        }
        .skin-option.selected span {
            color: white !important;
        }
        .accessory-option.selected {
            background: #434444ff !important;
            color: white !important;
            border-color: #434444ff !important;
        }

        /* Media Queries para Responsividad */
        @media (max-width: 768px) {
            .logo-corner img {
                width: 200px;
                top: 10px;
                left: 10px;
            }
            
            .title {
                font-size: 1.8rem !important;
                margin-bottom: 40px !important;
            }
            
            .avatars-container {
                flex-direction: column !important;
                gap: 20px !important;
                align-items: center !important;
            }
            
            .avatar img {
                width: 120px !important;
                height: 120px !important;
            }
            
            #inicioContainer {
                padding-top: 25vh !important;
                padding-left: 20px !important;
                padding-right: 20px !important;
            }
            
            .name-section, .customization-section {
                min-width: 90% !important;
                max-width: 95% !important;
                padding: 15px !important;
                margin: 5px !important;
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                max-height: 95vh !important;
                overflow-y: auto !important;
                box-sizing: border-box !important;
            }
            
            /* Ajustes espec칤ficos para customization-section en m칩vil */
            .customization-section {
                min-width: 95% !important;
                max-width: 98% !important;
                padding: 10px !important;
            }
            
            /* Ajustes para el contenido de deseos */
            .customization-section h3 {
                font-size: 1rem !important;
                margin-bottom: 8px !important;
            }
            
            .customization-section p {
                font-size: 0.8rem !important;
                margin-bottom: 10px !important;
            }
            
            .accessory-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
                max-width: 100% !important;
                margin: 0 auto !important;
            }
            
            .accessory-option {
                padding: 8px !important;
                font-size: 0.7rem !important;
                border-radius: 8px !important;
                text-align: center !important;
            }
            
            /* Contador de accesorios en m칩vil */
            .customization-section span {
                font-size: 0.8rem !important;
                padding: 4px 10px !important;
            }
            
            /* Bot칩n continuar en m칩vil */
            #continue-photo-button {
                padding: 10px 20px !important;
                font-size: 0.9rem !important;
                margin-top: 15px !important;
            }
            
            /* Ajustes espec칤ficos para el generador en m칩vil */
            #generatorContainer .main-content {
                width: 95% !important;
                max-width: 95% !important;
                min-width: unset !important;
                max-height: 80vh !important;
                padding: 15px !important;
                box-sizing: border-box !important;
            }
            
            .camera-btn, .generate-btn {
                padding: 12px 20px !important;
                font-size: 0.9rem !important;
                margin: 8px 0 !important;
                width: 100% !important;
                max-width: 200px !important;
                box-sizing: border-box !important;
            }
            
            #user-name {
                width: 250px !important;
                font-size: 1rem !important;
            }
            
            h2 {
                font-size: 1.3rem !important;
            }
            
            h3 {
                font-size: 1.1rem !important;
            }
            
            button {
                padding: 10px 20px !important;
                font-size: 1rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .logo-corner img {
                width: 150px;
            }
            
            .title {
                font-size: 1.5rem !important;
                margin-bottom: 30px !important;
            }
            
            .avatar img {
                width: 100px !important;
                height: 100px !important;
            }
            
            #inicioContainer {
                padding-top: 30vh !important;
                padding-left: 15px !important;
                padding-right: 15px !important;
            }
            
            .name-section, .customization-section {
                min-width: 98% !important;
                max-width: 99% !important;
                padding: 8px !important;
                max-height: 98vh !important;
                overflow-y: auto !important;
                box-sizing: border-box !important;
                margin: 2px !important;
            }
            
            /* Ajustes espec칤ficos para deseos en m칩vil peque침o */
            .customization-section h3 {
                font-size: 0.9rem !important;
                margin-bottom: 5px !important;
            }
            
            .customization-section p {
                font-size: 0.7rem !important;
                margin-bottom: 8px !important;
            }
            
            .accessory-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 6px !important;
                max-width: 100% !important;
            }
            
            .accessory-option {
                padding: 6px !important;
                font-size: 0.65rem !important;
                border-radius: 6px !important;
                min-height: 40px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            /* Contador m치s peque침o */
            .customization-section span {
                font-size: 0.7rem !important;
                padding: 3px 8px !important;
            }
            
            #continue-photo-button {
                padding: 8px 16px !important;
                font-size: 0.8rem !important;
                margin-top: 10px !important;
            }
            
            /* Ajustes espec칤ficos para el generador en m칩vil peque침o */
            #generatorContainer .main-content {
                width: 98% !important;
                max-width: 98% !important;
                min-width: unset !important;
                max-height: 85vh !important;
                padding: 10px !important;
                box-sizing: border-box !important;
                margin: 0 !important;
            }
            
            .camera-btn, .generate-btn {
                padding: 10px 15px !important;
                font-size: 0.8rem !important;
                margin: 5px 0 !important;
                width: 100% !important;
                max-width: 180px !important;
                box-sizing: border-box !important;
            }
            
            .result-image-container img {
                max-width: 100% !important;
                height: auto !important;
                max-height: 40vh !important;
            }
            
            h2 {
                font-size: 1.2rem !important;
            }
            
            h3 {
                font-size: 1rem !important;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .logo-corner img {
                width: 250px;
            }
            
            .avatars-container {
                gap: 30px !important;
            }
            
            .avatar img {
                width: 150px !important;
                height: 150px !important;
            }
            
            .name-section, .customization-section, .main-content {
                min-width: 500px !important;
                max-width: 80% !important;
            }
            
            .accessory-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
                max-width: 550px !important;
            }
        }
        
        /* Ajustes para orientaci칩n landscape en m칩viles */
        @media (max-height: 500px) and (orientation: landscape) {
            #inicioContainer {
                padding-top: 15vh !important;
            }
            
            .name-section, .customization-section {
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
            
            #generatorContainer .main-content {
                max-height: 90vh !important;
                overflow-y: auto !important;
                width: 90% !important;
                padding: 8px !important;
            }
            
            .title {
                margin-bottom: 20px !important;
                font-size: 1.3rem !important;
            }
        }
        
        /* Ajuste especial para pantallas muy peque침as */
        @media (max-height: 600px) {
            #inicioContainer {
                padding-top: 20vh !important;
            }
            
            .name-section, .customization-section {
                max-height: 85vh !important;
                overflow-y: auto !important;
            }
            
            #generatorContainer .main-content {
                max-height: 85vh !important;
                overflow-y: auto !important;
                padding: 8px !important;
            }
        }
        
        /* Estilos adicionales para prevenir overflow */
        .upload-section, .result-section {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .card {
            box-sizing: border-box !important;
            width: 100% !important;
        }
        
        .preview-container img, .result-image-container img {
            max-width: 100% !important;
            height: auto !important;
            box-sizing: border-box !important;
        }
        
        @media (max-width: 768px) {
            .preview-container img {
                max-height: 25vh !important;
            }
            
            .result-image-container img {
                max-height: 30vh !important;
            }
        }
        
        @media (max-width: 480px) {
            .preview-container img {
                max-height: 20vh !important;
            }
            
            .result-image-container img {
                max-height: 25vh !important;
            }
        }
    </style>
</head>
<body>
    <video autoplay muted loop class="video-background">
        <source src="img/fondo2.mp4" type="video/mp4">
    </video>
    
    <!-- Logo en esquina -->
    <div class="logo-corner">
        <img src="img/DEVELOPMENT_FACTOR.png" alt="Development Factor">
    </div>
    
    <div class="container" id="inicioContainer" style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;padding-top:15vh;">
        <h1 class="title" style="text-align:center;margin-bottom:60px;">춰COMIENZA AQU칈!</h1>
        <div class="avatars-container" style="display:flex;justify-content:center;gap:40px;margin-bottom:30px;">
            <div class="avatar" onclick="selectGender('masculino')" id="avatar-masculino" 
                 onmouseenter="changeAvatarImage('masculino', true)" 
                 onmouseleave="changeAvatarImage('masculino', false)">
                <img src="img/Hombre.jpg" alt="Avatar Masculino" id="img-masculino" style="width:180px;height:180px;border-radius:50%;object-fit:cover;transition:all 0.3s ease;border:3px solid transparent;">
            </div>
            <div class="avatar" onclick="selectGender('femenino')" id="avatar-femenino" 
                 onmouseenter="changeAvatarImage('femenino', true)" 
                 onmouseleave="changeAvatarImage('femenino', false)">
                <img src="img/Mujer.jpg" alt="Avatar Femenino" id="img-femenino" style="width:180px;height:180px;border-radius:50%;object-fit:cover;transition:all 0.3s ease;border:3px solid transparent;">
            </div>
        </div>
        <p class="gender-text" style="text-align:center;">Elige tu g칠nero</p>
        <div id="next-button" style="display: none; margin-top: 20px;">
            <button onclick="continuar()" style="background: #898a8aff; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: background 0.3s ease;">
                Continuar
            </button>
        </div>
    </div>
    <div class="container" id="mainContainer" style="display:none;">
        <div class="name-section" id="name-section" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); min-width: 400px;">
            <h2 style="color: #666; font-size: 1.5rem; margin-bottom: 20px;">쮺u치l es tu nombre?</h2>
            <input type="text" id="user-name" placeholder="Escribe tu nombre aqu칤" style="width: 300px; padding: 15px; border: 2px solid #ccc; border-radius: 25px; font-size: 1.2rem; text-align: center; margin-bottom: 20px; outline: none; transition: border-color 0.3s ease;" onfocus="this.style.borderColor='#434444ff'" onblur="this.style.borderColor='#ccc'">
            <br>
            <button onclick="continuarPersonalizacion()" style="background: #434444ff; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: background 0.3s ease; margin-top: 10px;">
                Continuar
            </button>
        </div>
        
        <div class="customization-section" id="customization-section" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); min-width: 600px; max-height: 80vh; overflow-y: auto;">
            
            <!-- Selecci칩n de accesorios -->
            <div id="skin-selection" style="margin-bottom: 30px;">
                <h3 style="color: #666; font-size: 1.2rem; margin-bottom: 10px; display: flex; align-items: center; justify-content: center;">
                   DESEOS DE A칌O NUEVO
                </h3>
                <p style="color: #888; font-size: 0.9rem; margin-bottom: 15px; text-align: center;">
                    Selecciona de 1 a 5 deseos para tu figura de a침o nuevo
                </p>
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: #434444ff; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;">
                        Seleccionados: <span id="contador-accesorios">0</span>/5
                    </span>
                </div>
                <div class="accessory-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; max-width: 600px; margin: 0 auto;">
                    <div class="accessory-option" onclick="selectAccessory('viajar')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Viajar
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('ejercicio')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Hacer ejercicio
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('mascota')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Adoptar una mascota
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('idioma')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Aprender un idioma
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('amor')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Encontrar el amor
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('suerte')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Tener buena suerte
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('batman')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Ser Batman
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('carro')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Cambiar de carro
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('conciertos')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Ir a conciertos
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('instrumento')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Tocar un instrumento
                    </div>
                    <div class="accessory-option" onclick="selectAccessory('organizado')" style="padding: 15px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; color: #666;">
                        Ser m치s organizado
                    </div>
                </div>
                
                <button onclick="continuarGenerador()" id="continue-photo-button" style="background: #434444ff; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: background 0.3s ease; margin-top: 20px; display: none;">
                    춰Crear mi figura!
                </button>
            </div>
        </div>
    </div>
    <div class="container" id="generatorContainer" style="display:none;">
        <main class="main-content" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(255,255,255,0.9); padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 90%; max-width: 500px; max-height: 85vh; overflow-y: auto; box-sizing: border-box;">
            <div class="upload-section">
                <div class="card" style="background: transparent; box-shadow: none; padding: 0;">
                    
                    <div class="upload-area" id="uploadArea">
                    
                        <button class="camera-btn" id="cameraBtn" type="button">
        游닝 Usar c치mara
    </button>
                        <div class="preview-container" id="previewContainer" style="display: none;">
                            <img id="imagePreview" alt="Preview">
                            <button class="remove-btn" id="removeBtn" title="Quitar imagen">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                   
                    <input type="hidden" id="promptInput" value="Crea una figura de acci칩n de cuerpo completo con la persona de la foto con vestimenta de a침o nuevo, en su caja original con ventana. La figura es como se muestra en la foto, su estilo es [ESTILO DE CABELLO], tono de piel [TONO DE PIEL], [GENERO]. En la parte superior, pon [NOMBRE] con 2026 debajo. Utiliza el color negro con detalles en dorado para la caja. Incluye , como 칰nicos accesorios, [ACCESORIOS] ordenados cuidadosamente a la derecha, proporcionales al modelo y colocados en ranuras empotradas con el modelo. Dise침a en estilo realista, pareciendo una persona real con iluminaci칩n suave y un dise침o claro, como un producto de tienda de juguetes. La caja esta sobre una mesa de madera, dentro de una casa c치lida con ambientaci칩n navide침a">
                </div>

                <button class="generate-btn" id="generateBtn" disabled>
                    <span class="btn-text">Generar Imagen</span>
                   
                </button>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <div class="card result-card">
                    <h2>Tu creaci칩n</h2>
                    <div class="result-image-container">
                        <img id="resultImage" alt="Generated Image">
                    </div>
                    <div class="result-actions">
                        <button class="action-btn download-btn" id="downloadBtn" onclick="descargarImagen()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Descargar
                        </button>
                        <button class="action-btn secondary" id="newBtn" onclick="reiniciarProceso()">
                            Crear otra
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <div class="loading-overlay" id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; justify-content: center; align-items: center;">
            <div class="loader"></div>
        </div>

        <div class="toast" id="toast"></div>

       
    </div>

    <!-- Modal de c치mara -->
<div class="camera-modal" id="cameraModal" style="display: none;">
    <div class="camera-content">
        <video id="cameraVideo" autoplay playsinline></video>
        <button id="captureBtn">Capturar foto</button>
        <button id="closeCameraBtn">Cerrar</button>
    </div>
</div>

    <script src="app.js"></script>
    <script>
        function changeAvatarImage(genero, isHover) {
            const imgElement = document.getElementById('img-' + genero);
            const isSelected = document.getElementById('avatar-' + genero).classList.contains('selected');
            
            if (genero === 'masculino') {
                if (isHover || isSelected) {
                    imgElement.src = 'img/Hombre-1.jpg';
                } else {
                    imgElement.src = 'img/Hombre.jpg';
                }
            } else if (genero === 'femenino') {
                if (isHover || isSelected) {
                    imgElement.src = 'img/Mujer-1.jpg';
                } else {
                    imgElement.src = 'img/Mujer.jpg';
                }
            }
        }

        function selectGender(genero) {
            // Marcar avatar seleccionado
            document.getElementById('avatar-masculino').classList.remove('selected');
            document.getElementById('avatar-femenino').classList.remove('selected');
            
            // Restablecer im치genes a estado normal
            document.getElementById('img-masculino').src = 'img/Hombre.jpg';
            document.getElementById('img-femenino').src = 'img/Mujer.jpg';
            
            // Marcar nuevo avatar seleccionado y cambiar su imagen
            document.getElementById('avatar-' + genero).classList.add('selected');
            changeAvatarImage(genero, false);
            
            window.sexoSeleccionado = genero;
            document.getElementById('next-button').style.display = 'block';
        }
        
        function continuar() {
            document.getElementById('inicioContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            document.getElementById('name-section').style.display = 'block';
        }
        
        function continuarPersonalizacion() {
            // Validar nombre
            var nombre = document.getElementById('user-name').value.trim();
            if (!nombre) {
                alert('Por favor, ingresa tu nombre');
                return;
            }
            window.nombreUsuario = nombre;
            document.getElementById('name-section').style.display = 'none';
            document.getElementById('customization-section').style.display = 'block';
        }
        
        function selectAccessory(accessory) {
            if (!window.accesoriosSeleccionados) {
                window.accesoriosSeleccionados = [];
            }
            
            // Toggle selecci칩n del accesorio
            const element = event.target;
            const isSelected = element.classList.contains('selected');
            
            if (isSelected) {
                element.classList.remove('selected');
                const index = window.accesoriosSeleccionados.indexOf(accessory);
                if (index > -1) {
                    window.accesoriosSeleccionados.splice(index, 1);
                }
            } else {
                // Verificar si ya se han seleccionado 5 accesorios
                if (window.accesoriosSeleccionados.length >= 5) {
                    alert('Puedes seleccionar m치ximo 5 deseos de a침o nuevo');
                    return;
                }
                element.classList.add('selected');
                window.accesoriosSeleccionados.push(accessory);
            }
            
            // Actualizar contador
            const contador = document.getElementById('contador-accesorios');
            if (contador) {
                contador.textContent = window.accesoriosSeleccionados.length;
            }
            
            // Mostrar bot칩n si al menos un accesorio est치 seleccionado
            if (window.accesoriosSeleccionados.length > 0) {
                document.getElementById('continue-photo-button').style.display = 'inline-block';
            } else {
                document.getElementById('continue-photo-button').style.display = 'none';
            }
        }
        
        function continuarGenerador() {
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('generatorContainer').style.display = 'block';
            
            // Construir el prompt con los valores seleccionados
            const nombre = window.nombreUsuario || 'Usuario';
            const genero = window.sexoSeleccionado || 'masculino';
            const accesorios = window.accesoriosSeleccionados && window.accesoriosSeleccionados.length > 0 
                ? window.accesoriosSeleccionados.join(', ') 
                : 'ning칰n accesorio';
            
            const promptCompleto = `Crea una figura de acci칩n de cuerpo completo con la persona de la foto con vestimenta de a침o nuevo, en su caja original con ventana. 
            La figura es como se muestra en la foto, ${genero}. En la parte superior, pon ${nombre} con 2026 debajo. Utiliza el color negro con detalles en dorado para la caja.
             Incluye , como 칰nicos accesorios, ${accesorios} ordenados cuidadosamente a la derecha, proporcionales al modelo y colocados en ranuras empotradas con el modelo. 
             Dise침a en estilo realista, pareciendo una persona real con iluminaci칩n suave y un dise침o claro, como un producto de tienda de juguetes. 
             La caja esta sobre una mesa de madera, dentro de una casa c치lida con ambientaci칩n navide침a`;
            
            const promptInput = document.getElementById('promptInput');
            promptInput.value = promptCompleto;
        }
        
        function continuarFoto() {
            document.getElementById('customization-section').style.display = 'none';
            document.getElementById('camera-section').style.display = 'block';
        }
        function finalizar() {
            // Validar que se haya tomado la foto
            var photoTaken = document.getElementById('captured-photo').src && document.getElementById('captured-photo').src.startsWith('data:image');
            if (!photoTaken) {
                alert('Por favor, toma tu foto primero');
                return;
            }
            // Oculta todo y muestra el generador de imagen
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('generatorContainer').style.display = 'block';
            // Opcional: puedes pasar los datos seleccionados al generador si lo necesitas
        }
        function startCamera() {
            const video = document.getElementById('video');
            // Detener stream anterior si existe
            if (window.stream && window.stream.getTracks) {
                window.stream.getTracks().forEach(track => track.stop());
            }
            navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                .then(function(stream) {
                    window.stream = stream;
                    video.srcObject = stream;
                    video.style.display = 'block';
                    document.getElementById('take-photo-btn').style.display = 'inline-block';
                    document.getElementById('start-camera-btn').style.display = 'none';
                })
                .catch(function(err) {
                    alert('No se pudo acceder a la c치mara: ' + err.message);
                });
        }

        function takePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            // Asegura que el canvas tenga el mismo tama침o que el video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Dibuja el frame actual del video en el canvas
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convierte el canvas a imagen base64 y lo guarda
            const dataUrl = canvas.toDataURL('image/png');
            window.capturedPhotoData = dataUrl;

            // Detiene el stream de la c치mara
            if (window.stream && window.stream.getTracks) {
                window.stream.getTracks().forEach(track => track.stop());
                window.stream = null;
            }

            // Ir directamente al generador
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('generatorContainer').style.display = 'block';
        }

        function retakePhoto() {
            document.getElementById('video').style.display = 'block';
            document.getElementById('start-camera-btn').style.display = 'inline-block';
            document.getElementById('take-photo-btn').style.display = 'none';
        }

        function reiniciarProceso() {
            // Ocultar todas las secciones
            document.getElementById('generatorContainer').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            
            // Limpiar selecciones
            document.getElementById('avatar-masculino').classList.remove('selected');
            document.getElementById('avatar-femenino').classList.remove('selected');
            document.getElementById('img-masculino').src = 'img/Hombre.jpg';
            document.getElementById('img-femenino').src = 'img/Mujer.jpg';
            document.getElementById('next-button').style.display = 'none';
            
            // Limpiar campos
            document.getElementById('user-name').value = '';
            
            // Limpiar selecciones de cabello y accesorios
            document.querySelectorAll('.accessory-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Reiniciar contador
            const contador = document.getElementById('contador-accesorios');
            if (contador) {
                contador.textContent = '0';
            }
            
            // Ocultar botones de continuar
            document.getElementById('continue-photo-button').style.display = 'none';
            
            // Resetear secciones
            document.getElementById('name-section').style.display = 'none';
            document.getElementById('customization-section').style.display = 'none';
            
            // Limpiar variables globales
            window.sexoSeleccionado = null;
            window.nombreUsuario = null;
            window.cabelloSeleccionado = null;
            window.tonoSeleccionado = null;
            window.accesoriosSeleccionados = [];
            
            // Mostrar pantalla inicial
            document.getElementById('inicioContainer').style.display = 'flex';
        }
        
        // Funci칩n para generar nombre de archivo personalizado
        function generarNombreArchivo() {
            const nombre = window.nombreUsuario || 'Usuario';
            const fecha = new Date();
            const dia = String(fecha.getDate()).padStart(2, '0');
            const mes = String(fecha.getMonth() + 1).padStart(2, '0');
            const a침o = fecha.getFullYear();
            
            // Limpiar nombre del usuario (remover caracteres especiales)
            const nombreLimpio = nombre.replace(/[^a-zA-Z0-9치칠칤칩칰침츼칄칈칍칔칌]/g, '_');
            
            return `Figura_${nombreLimpio}_A침oNuevo_2026_${dia}-${mes}-${a침o}.png`;
        }
        
        // Funci칩n para descargar la imagen con nombre personalizado
        function descargarImagen() {
            const imgElement = document.getElementById('resultImage');
            if (!imgElement || !imgElement.src) {
                alert('No hay imagen para descargar');
                return;
            }
            
            // Verificar que tenemos el nombre del usuario
            if (!window.nombreUsuario) {
                window.nombreUsuario = 'Usuario';
            }
            
            // Crear un canvas temporal para convertir la imagen
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Crear una nueva imagen para cargar la imagen resultado
            const img = new Image();
            img.crossOrigin = 'anonymous'; // Para evitar problemas de CORS
            
            img.onload = function() {
                // Establecer el tama침o del canvas igual a la imagen
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Dibujar la imagen en el canvas
                ctx.drawImage(img, 0, 0);
                
                // Convertir canvas a blob y descargar con nombre personalizado
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = generarNombreArchivo();
                    link.style.display = 'none';
                    
                    // Agregar el link al DOM temporalmente y hacer click
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Limpiar URL temporal
                    URL.revokeObjectURL(url);
                    
                    // Mostrar mensaje de confirmaci칩n
                    console.log('Imagen descargada como:', generarNombreArchivo());
                }, 'image/png', 1.0);
            };
            
            img.onerror = function() {
                console.log('Error cargando imagen, usando m칠todo alternativo');
                // Si hay error cargando la imagen, usar m칠todo alternativo
                descargarImagenAlternativo();
            };
            
            // Cargar la imagen
            img.src = imgElement.src;
        }
        
        // M칠todo alternativo de descarga (si el principal falla)
        function descargarImagenAlternativo() {
            const imgElement = document.getElementById('resultImage');
            const link = document.createElement('a');
            
            // Usar la imagen directamente con nombre personalizado
            link.href = imgElement.src;
            link.download = generarNombreArchivo();
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('Imagen descargada (m칠todo alternativo) como:', generarNombreArchivo());
        }
    </script>
</body>
</html>
